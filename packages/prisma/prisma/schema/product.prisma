model Category {
  id           String   @id @default(cuid())
  name         String   @unique
  slug         String   @unique
  description  String?
  imageUrl     String?  @map("image_url")
  displayOrder Int      @default(0) @map("display_order")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  subCategories SubCategory[]

  @@index([slug])
  @@index([isActive])
  @@index([displayOrder])
  @@map("categories")
}

model SubCategory {
  id           String   @id @default(cuid())
  name         String
  slug         String   @unique
  description  String?
  imageUrl     String?  @map("image_url")
  categoryId   String   @map("category_id")
  displayOrder Int      @default(0) @map("display_order")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  category Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  products Product[]

  @@index([categoryId])
  @@index([slug])
  @@index([isActive])
  @@index([displayOrder])
  @@map("sub_categories")
}

model Product {
  id                String   @id @default(cuid())
  name              String
  slug              String   @unique
  description       String   @db.Text
  shortDescription  String?  @map("short_description") @db.VarChar(500)
  price             Decimal  @db.Decimal(10, 2)
  compareAtPrice    Decimal? @map("compare_at_price") @db.Decimal(10, 2)
  costPrice         Decimal? @map("cost_price") @db.Decimal(10, 2)
  stock             Int      @default(0)
  lowStockThreshold Int      @default(10) @map("low_stock_threshold")
  sku               String?  @unique
  barcode           String?  @unique
  weight            Decimal? @db.Decimal(8, 2)
  dimensions        String? // JSON: {length, width, height}
  imageUrl          String   @map("image_url")
  isActive          Boolean  @default(true) @map("is_active")
  isFeatured        Boolean  @default(false) @map("is_featured")
  isPrescriptionReq Boolean  @default(false) @map("is_prescription_required")
  viewCount         Int      @default(0) @map("view_count")
  salesCount        Int      @default(0) @map("sales_count")
  avgRating         Decimal? @default(0) @map("avg_rating") @db.Decimal(3, 2)
  reviewCount       Int      @default(0) @map("review_count")
  subCategoryId     String   @map("sub_category_id")

  // Extended product information
  manufacturer        String?
  manufacturerAddress String? @map("manufacturer_address") @db.Text
  type                String?
  packaging           String?
  packageQty          String? @map("package_qty")
  productForm         String? @map("product_form")
  productHighlights   String? @map("product_highlights") @db.Text
  information         String? @db.Text
  keyIngredients      String? @map("key_ingredients") @db.Text
  keyBenefits         String? @map("key_benefits") @db.Text
  directionsForUse    String? @map("directions_for_use") @db.Text
  safetyInformation   String? @map("safety_information") @db.Text
  countryOfOrigin     String? @map("country_of_origin")
  manufacturerDetails String? @map("manufacturer_details") @db.Text
  marketerDetails     String? @map("marketer_details") @db.Text

  // SEO fields
  metaTitle       String? @map("meta_title")
  metaDescription String? @map("meta_description")
  metaKeywords    String? @map("meta_keywords")

  // Timestamps
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  publishedAt DateTime? @map("published_at")

  // Relations
  subCategory  SubCategory                 @relation(fields: [subCategoryId], references: [id], onDelete: Restrict)
  cartItems    CartItem[]
  orderItems   OrderItem[]
  variantTypes VariantType[]
  combinations ProductVariantCombination[]
  images       ProductImage[]
  wishlists    Wishlist[]
  reviews      Review[]

  @@index([slug])
  @@index([subCategoryId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([price])
  @@index([stock])
  @@index([avgRating])
  @@index([salesCount])
  @@index([createdAt])
  @@index([name]) // For text search
  @@map("products")
}

model ProductImage {
  id           String   @id @default(cuid())
  url          String
  key          String // S3/Storage key for deletion
  altText      String?  @map("alt_text")
  displayOrder Int      @default(0) @map("display_order")
  productId    String   @map("product_id")
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([displayOrder])
  @@map("product_images")
}